function t(t,e,s,n){if(s==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e==="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?n:s==="a"?n.call(t):n?n.value:e.get(t)}function e(t,e,s,n,a){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e==="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?a.call(t,s):a?a.value=s:e.set(t,s),s}const s="website favicon is required";const n="Wallet is not connected";const a="Invalid sign params";const i="Request failed by timeout";const r="bearby-web3 available only browser";const o="bearby Web3 instance already created!";var c;class l{constructor(t){c.set(this,void 0);e(this,c,t,"f")}deploy(){}call(){}read(){}}c=new WeakMap;const h="BearBy";const d={CONTENT:`@/${h}/content-script`,INJECTED:`@/${h}/injected-script`};const u={GET_DATA:`@/${h}/get-wallet-data`,ACCOUNT_CHANGED:`@/${h}/accounts-just-changed`,CONTENT_PROXY_MEHTOD:`@/${h}/proxy-method`,CONTENT_PROXY_RESULT:`@/${h}/response-from-content`,CONNECT_APP:`@/${h}/connect-app`,RESPONSE_CONNECT_APP:`@/${h}/respoonse-connect-app`,NETWORK_CHANGED:`@/${h}/network-just-changed`,LOCKED:`@/${h}/guard-just-lock`,TX_TO_SEND:`@/${h}/add-tx-to-send`,TX_TO_SEND_RESULT:`@/${h}/response-tx-result`,SIGN_MESSAGE:`@/${h}/sign-message-call`,SING_MESSAGE_RESULT:`@/${h}/sign-message-response`};var f,E,p,y,T;const{document:w}=globalThis;class _{constructor(t){f.add(this);E.set(this,void 0);e(this,E,t,"f")}listen(e){w.addEventListener(t(this,E,"f"),(t=>{if(t&&t.detail){e(JSON.parse(t.detail))}}))}send(e,s){e.from=t(this,E,"f");if(Object.values(d).includes(s)){t(this,f,"m",p).call(this,JSON.stringify(e),s)}}}E=new WeakMap,f=new WeakSet,p=function e(s,n){w.dispatchEvent(t(this,f,"m",T).call(this,s,n))},y=function t(e){return{detail:e}},T=function e(s,n){return new CustomEvent(n,t(this,f,"m",y).call(this,s))};var m;class S{constructor(){m.set(this,[])}on(e){t(this,m,"f").push(e);return()=>this.removeListener(e)}removeListener(e){const s=t(this,m,"f").indexOf(e);if(s>-1)t(this,m,"f").splice(s,1)}removeAllListeners(){t(this,m,"f").splice(0,t(this,m,"f").length)}emit(...e){t(this,m,"f").forEach((t=>t.apply(this,e)))}once(t){const e=this.on(((...s)=>{e();t.apply(this,s)}))}}m=new WeakMap;var N;class b{constructor(t){N.set(this,void 0);e(this,N,t,"f")}get type(){return t(this,N,"f").type}get payload(){return t(this,N,"f").payload}send(e,s){const n=JSON.stringify(t(this,N,"f"));const a=JSON.parse(n);e.send(a,s)}}N=new WeakMap;class C{constructor(){this.stream=new _(d.INJECTED);this.subject=new S;if(globalThis.document){this.stream.listen((t=>{this.subject.emit(t)}))}}initialized(){const t=u.GET_DATA;const e=d.CONTENT;new b({type:t,payload:{}}).send(this.stream,e)}}function O(){const t=20;return[...Array(t)].map((()=>Math.floor(Math.random()*16).toString(16))).join("")}const g=5e3;var v,A;class R{constructor(t,s){v.set(this,void 0);A.set(this,void 0);e(this,v,t,"f");e(this,A,s,"f")}async send(e){const s=u.CONTENT_PROXY_MEHTOD;const n=d.CONTENT;const a=O();let r;new b({type:s,payload:{body:e,uuid:a}}).send(t(this,v,"f"),n);const o=new Promise(((e,s)=>{r=t(this,A,"f").on((t=>{if(t.type!==u.CONTENT_PROXY_RESULT)return;if(!t.payload||!t.payload.uuid)return;if(t.payload.uuid!==a)return;if(t.payload&&t.payload.reject){r();return s(new Error(t.payload.reject))}delete t.payload.uuid;r();return e(t.payload.resolve)}))}));const c=new Promise(((t,e)=>{setTimeout((()=>{if(r)r();e(new Error(i))}),g)}));return Promise.race([o,c])}}v=new WeakMap,A=new WeakMap;var k;(function(t){t["GET_STATUS"]="get_status";t["GET_ADDRESSES"]="get_addresses";t["GET_BLOCKS"]="get_block";t["GET_ENDORSEMENTS"]="get_endorsements";t["GET_OPERATIONS"]="get_operations";t["GET_CLIQUES"]="get_cliques";t["GET_STAKERS"]="get_stakers";t["GET_FILTERED_SC_OUTPUT_EVENT"]="get_filtered_sc_output_event";t["EXECUTE_READ_ONLY_BYTECODE"]="execute_read_only_bytecode";t["EXECUTE_READ_ONLY_CALL"]="execute_read_only_call"})(k||(k={}));function D(t){return Array.from(t,(t=>t.toString(16).padStart(2,"0"))).join("")}class G{constructor(t,e,s,n,a,i){this.type=t;this.amount=String(e);this.recipient=s;this.parameter=n;this.contract=a?D(a):a;this.functionName=i}get payload(){return JSON.parse(JSON.stringify({type:this.type,amount:this.amount,fee:this.fee,gasPrice:this.gasPrice,gasLimit:this.gasLimit,coins:this.coins,code:this.contract,func:this.functionName,params:JSON.stringify(this.parameter),parallelCoins:this.parallelCoins,sequentialCoins:this.sequentialCoins,toAddr:this.recipient}))}}var P;(function(t){t[t["Payment"]=0]="Payment";t[t["RollBuy"]=1]="RollBuy";t[t["RollSell"]=2]="RollSell";t[t["ExecuteSC"]=3]="ExecuteSC";t[t["CallSC"]=4]="CallSC"})(P||(P={}));var M,L;class W{constructor(t,s){M.set(this,void 0);L.set(this,void 0);e(this,M,t,"f");e(this,L,s,"f")}async getNodesStatus(){const e=k.GET_STATUS;return t(this,M,"f").send([{method:e,params:[]}])}async getAddresses(...e){const s=k.GET_ADDRESSES;return t(this,M,"f").send([{method:s,params:[e]}])}async getBlocks(...e){const s=k.GET_BLOCKS;return t(this,M,"f").send([{method:s,params:[e]}])}async getOperations(...e){const s=k.GET_OPERATIONS;return t(this,M,"f").send([{method:s,params:[e]}])}async getStakers(){const e=k.GET_STAKERS;return t(this,M,"f").send([{method:e,params:[]}])}async getEndorsements(...e){const s=k.GET_ENDORSEMENTS;return t(this,M,"f").send([{method:s,params:[e]}])}async getCliques(){const e=k.GET_CLIQUES;return t(this,M,"f").send([{method:e,params:[]}])}async getFilteredSCOutputEvent(e){const s=k.GET_FILTERED_SC_OUTPUT_EVENT;return t(this,M,"f").send([{method:s,params:[e]}])}async executeReadOlyBytecode(e){const s=k.EXECUTE_READ_ONLY_BYTECODE;return t(this,M,"f").send([{method:s,params:[e]}])}async executeReadOnlyCall(e){const s=k.EXECUTE_READ_ONLY_CALL;return t(this,M,"f").send([{method:s,params:[e]}])}async payment(e,s){const n=new G(P.Payment,e,s);return t(this,L,"f").signTransaction(n)}async buyRolls(e){const s=new G(P.RollBuy,e);return t(this,L,"f").signTransaction(s)}async sellRolls(e){const s=new G(P.RollSell,e);return t(this,L,"f").signTransaction(s)}}M=new WeakMap,L=new WeakMap;function j(t,e){if(!t){throw new Error(e)}}function U(){let t=globalThis.document.querySelector("link[rel*='icon']");if(!t){throw new Error(s)}return t.href}var $,I;class B{constructor(t,s){$.set(this,void 0);I.set(this,void 0);e(this,$,t,"f");e(this,I,s,"f")}get base58(){return t(this,I,"f")}subscribe(s){if(this.base58){s(this.base58)}const n=t(this,$,"f").on((n=>{switch(n.type){case u.ACCOUNT_CHANGED:e(this,I,n.payload.base58,"f");break;case u.GET_DATA:e(this,I,n.payload.base58,"f");break;default:return}s(t(this,I,"f"))}));return{unsubscribe:()=>n()}}}$=new WeakMap,I=new WeakMap;var X,x;class Y{constructor(t,s){X.set(this,void 0);x.set(this,void 0);e(this,X,t,"f");if(s){e(this,x,s,"f")}}get net(){return t(this,x,"f")}subscribe(s){s(this.net);const n=t(this,X,"f").on((t=>{switch(t.type){case u.GET_DATA:e(this,x,t.payload.net,"f");break;case u.NETWORK_CHANGED:e(this,x,t.payload.net,"f");break;default:return}s(this.net)}));return{unsubscribe:()=>n()}}}X=new WeakMap,x=new WeakMap;var J,K,H,q,z,F,Q,V;class Z{constructor(s,n){J.add(this);K.set(this,void 0);H.set(this,void 0);q.set(this,void 0);z.set(this,void 0);F.set(this,false);Q.set(this,false);e(this,q,s,"f");e(this,z,n,"f");e(this,K,new B(n),"f");e(this,H,new Y(n),"f");t(this,J,"m",V).call(this)}get account(){return t(this,K,"f")}get network(){return t(this,H,"f")}get connected(){return t(this,F,"f")}get enabled(){return t(this,Q,"f")}async connect(){const s=u.CONNECT_APP;const n=d.CONTENT;const a=O();const i=window.document.title;const r=U();const o={title:i,icon:r,uuid:a};new b({type:s,payload:o}).send(t(this,q,"f"),n);return new Promise(((s,n)=>{const i=t(this,z,"f").on((r=>{if(r.type!==u.RESPONSE_CONNECT_APP)return;if(r.payload.uuid!==a)return;if(r.payload.reject){i();return n(new Error(r.payload.reject))}e(this,F,Boolean(r.payload.resolve),"f");e(this,K,new B(t(this,z,"f"),r.payload.base58),"f");i();return s(this.connected)}))}))}async signMessage(e){j(this.connected,n);const s=u.SIGN_MESSAGE;const a=d.CONTENT;const i=O();const r=window.document.title;const o=U();const c={message:e,uuid:i,title:r,icon:o};new b({type:s,payload:c}).send(t(this,q,"f"),a);return new Promise(((e,s)=>{const n=t(this,z,"f").on((t=>{if(t.type!==u.SING_MESSAGE_RESULT)return;if(t.payload.uuid!==i)return;if(t.payload&&t.payload.reject){n();return s(new Error(t.payload.reject))}n();return e(t.payload.resolve)}))}))}async signTransaction(e){j(this.connected,n);j(e instanceof G,a);const s=u.TX_TO_SEND;const i=d.CONTENT;const r=O();const o={...e.payload,uuid:r,title:window.document.title,icon:U()};new b({type:s,payload:o}).send(t(this,q,"f"),i);return new Promise(((e,s)=>{const n=t(this,z,"f").on((t=>{if(t.type!==u.TX_TO_SEND_RESULT)return;if(t.payload.uuid!==r)return;if(t.payload&&t.payload.reject){n();return s(new Error(t.payload.reject))}n();return e(t.payload.resolve)}))}))}subscribe(e){const s=t(this,z,"f").on((()=>{setTimeout((()=>e()),1)}));return{unsubscribe:()=>s()}}}K=new WeakMap,H=new WeakMap,q=new WeakMap,z=new WeakMap,F=new WeakMap,Q=new WeakMap,J=new WeakSet,V=function s(){if(!globalThis.window)return;t(this,z,"f").on((s=>{switch(s.type){case u.LOCKED:e(this,Q,s.payload.enabled,"f");break;case u.ACCOUNT_CHANGED:e(this,K,new B(t(this,z,"f"),s.payload.base58),"f");break;case u.GET_DATA:e(this,K,new B(t(this,z,"f"),s.payload.base58),"f");e(this,Q,s.payload.enabled,"f");e(this,F,s.payload.connected,"f");e(this,H,new Y(t(this,z,"f"),s.payload.net),"f");break;case u.NETWORK_CHANGED:e(this,H,new Y(t(this,z,"f"),s.payload.net),"f");break}}))};var tt,et;class st{constructor(){tt.set(this,new C);et.set(this,new R(t(this,tt,"f").stream,t(this,tt,"f").subject));this.wallet=new Z(t(this,tt,"f").stream,t(this,tt,"f").subject);this.contract=new l(t(this,et,"f"));this.massa=new W(t(this,et,"f"),this.wallet);if(globalThis.window["bearby"]){throw new Error(o)}try{t(this,tt,"f").initialized();globalThis.window["bearby"]=Object.freeze(this)}catch(t){console.debug(r)}}}tt=new WeakMap,et=new WeakMap;const nt=new st;export{R as ContentProvider,W as Massa,Z as Wallet,st as Web3,nt as default,nt as web3};
//# sourceMappingURL=index.js.map
