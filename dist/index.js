(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports):typeof define==="function"&&define.amd?define(["exports"],e):(t=typeof globalThis!=="undefined"?globalThis:t||self,e(t.web3={}))})(this,(function(t){"use strict";function e(t,e,s,n){if(s==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e==="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?n:s==="a"?n.call(t):n?n.value:e.get(t)}function s(t,e,s,n,a){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e==="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?a.call(t,s):a?a.value=s:e.set(t,s),s}const n="website favicon is required";const a="Wallet is not connected";const i="Invalid sign params";const o="Request failed by timeout";const r="bearby-web3 available only browser";const c="bearby Web3 instance already created!";var l;class h{constructor(t){l.set(this,void 0);s(this,l,t,"f")}deploy(){}call(){}read(){}}l=new WeakMap;const d="BearBy";const u={CONTENT:`@/${d}/content-script`,INJECTED:`@/${d}/injected-script`};const f={GET_DATA:`@/${d}/get-wallet-data`,ACCOUNT_CHANGED:`@/${d}/accounts-just-changed`,CONTENT_PROXY_MEHTOD:`@/${d}/proxy-method`,CONTENT_PROXY_RESULT:`@/${d}/response-from-content`,CONNECT_APP:`@/${d}/connect-app`,RESPONSE_CONNECT_APP:`@/${d}/respoonse-connect-app`,NETWORK_CHANGED:`@/${d}/network-just-changed`,LOCKED:`@/${d}/guard-just-lock`,TX_TO_SEND:`@/${d}/add-tx-to-send`,TX_TO_SEND_RESULT:`@/${d}/response-tx-result`,SIGN_MESSAGE:`@/${d}/sign-message-call`,SING_MESSAGE_RESULT:`@/${d}/sign-message-response`};var p,E,y,T,w;const{document:_}=globalThis;class m{constructor(t){p.add(this);E.set(this,void 0);s(this,E,t,"f")}listen(t){_.addEventListener(e(this,E,"f"),(e=>{if(e&&e.detail){t(JSON.parse(e.detail))}}))}send(t,s){t.from=e(this,E,"f");if(Object.values(u).includes(s)){e(this,p,"m",y).call(this,JSON.stringify(t),s)}}}E=new WeakMap,p=new WeakSet,y=function t(s,n){_.dispatchEvent(e(this,p,"m",w).call(this,s,n))},T=function t(e){return{detail:e}},w=function t(s,n){return new CustomEvent(n,e(this,p,"m",T).call(this,s))};var S;class b{constructor(){S.set(this,[])}on(t){e(this,S,"f").push(t);return()=>this.removeListener(t)}removeListener(t){const s=e(this,S,"f").indexOf(t);if(s>-1)e(this,S,"f").splice(s,1)}removeAllListeners(){e(this,S,"f").splice(0,e(this,S,"f").length)}emit(...t){e(this,S,"f").forEach((e=>e.apply(this,t)))}once(t){const e=this.on(((...s)=>{e();t.apply(this,s)}))}}S=new WeakMap;var N;class C{constructor(t){N.set(this,void 0);s(this,N,t,"f")}get type(){return e(this,N,"f").type}get payload(){return e(this,N,"f").payload}send(t,s){const n=JSON.stringify(e(this,N,"f"));const a=JSON.parse(n);t.send(a,s)}}N=new WeakMap;class O{constructor(){this.stream=new m(u.INJECTED);this.subject=new b;if(globalThis.document){this.stream.listen((t=>{this.subject.emit(t)}))}}initialized(){const t=f.GET_DATA;const e=u.CONTENT;new C({type:t,payload:{}}).send(this.stream,e)}}function g(){const t=20;return[...Array(t)].map((()=>Math.floor(Math.random()*16).toString(16))).join("")}const v=5e3;var A,R;class k{constructor(t,e){A.set(this,void 0);R.set(this,void 0);s(this,A,t,"f");s(this,R,e,"f")}async send(t){const s=f.CONTENT_PROXY_MEHTOD;const n=u.CONTENT;const a=g();let i;new C({type:s,payload:{body:t,uuid:a}}).send(e(this,A,"f"),n);const r=new Promise(((t,s)=>{i=e(this,R,"f").on((e=>{if(e.type!==f.CONTENT_PROXY_RESULT)return;if(!e.payload||!e.payload.uuid)return;if(e.payload.uuid!==a)return;if(e.payload&&e.payload.reject){i();return s(new Error(e.payload.reject))}delete e.payload.uuid;i();return t(e.payload.resolve)}))}));const c=new Promise(((t,e)=>{setTimeout((()=>{if(i)i();e(new Error(o))}),v)}));return Promise.race([r,c])}}A=new WeakMap,R=new WeakMap;var D;(function(t){t["GET_STATUS"]="get_status";t["GET_ADDRESSES"]="get_addresses";t["GET_BLOCKS"]="get_block";t["GET_ENDORSEMENTS"]="get_endorsements";t["GET_OPERATIONS"]="get_operations";t["GET_CLIQUES"]="get_cliques";t["GET_STAKERS"]="get_stakers";t["GET_FILTERED_SC_OUTPUT_EVENT"]="get_filtered_sc_output_event";t["EXECUTE_READ_ONLY_BYTECODE"]="execute_read_only_bytecode";t["EXECUTE_READ_ONLY_CALL"]="execute_read_only_call"})(D||(D={}));function G(t){return Array.from(t,(t=>t.toString(16).padStart(2,"0"))).join("")}class P{constructor(t,e,s,n,a,i){this.type=t;this.amount=String(e);this.recipient=s;this.parameter=n;this.contract=a?G(a):a;this.functionName=i}get payload(){return JSON.parse(JSON.stringify({type:this.type,amount:this.amount,fee:this.fee,gasPrice:this.gasPrice,gasLimit:this.gasLimit,coins:this.coins,code:this.contract,func:this.functionName,params:JSON.stringify(this.parameter),parallelCoins:this.parallelCoins,sequentialCoins:this.sequentialCoins,toAddr:this.recipient}))}}var M;(function(t){t[t["Payment"]=0]="Payment";t[t["RollBuy"]=1]="RollBuy";t[t["RollSell"]=2]="RollSell";t[t["ExecuteSC"]=3]="ExecuteSC";t[t["CallSC"]=4]="CallSC"})(M||(M={}));var W,L;class j{constructor(t,e){W.set(this,void 0);L.set(this,void 0);s(this,W,t,"f");s(this,L,e,"f")}async getNodesStatus(){const t=D.GET_STATUS;return e(this,W,"f").send([{method:t,params:[]}])}async getAddresses(...t){const s=D.GET_ADDRESSES;return e(this,W,"f").send([{method:s,params:[t]}])}async getBlocks(...t){const s=D.GET_BLOCKS;return e(this,W,"f").send([{method:s,params:[t]}])}async getOperations(...t){const s=D.GET_OPERATIONS;return e(this,W,"f").send([{method:s,params:[t]}])}async getStakers(){const t=D.GET_STAKERS;return e(this,W,"f").send([{method:t,params:[]}])}async getEndorsements(...t){const s=D.GET_ENDORSEMENTS;return e(this,W,"f").send([{method:s,params:[t]}])}async getCliques(){const t=D.GET_CLIQUES;return e(this,W,"f").send([{method:t,params:[]}])}async getFilteredSCOutputEvent(t){const s=D.GET_FILTERED_SC_OUTPUT_EVENT;return e(this,W,"f").send([{method:s,params:[t]}])}async executeReadOlyBytecode(t){const s=D.EXECUTE_READ_ONLY_BYTECODE;return e(this,W,"f").send([{method:s,params:[t]}])}async executeReadOnlyCall(t){const s=D.EXECUTE_READ_ONLY_CALL;return e(this,W,"f").send([{method:s,params:[t]}])}async payment(t,s){const n=new P(M.Payment,t,s);return e(this,L,"f").signTransaction(n)}async buyRolls(t){const s=new P(M.RollBuy,t);return e(this,L,"f").signTransaction(s)}async sellRolls(t){const s=new P(M.RollSell,t);return e(this,L,"f").signTransaction(s)}}W=new WeakMap,L=new WeakMap;function U(t,e){if(!t){throw new Error(e)}}function $(){let t=globalThis.document.querySelector("link[rel*='icon']");if(!t){throw new Error(n)}return t.href}var x,I;class B{constructor(t,e){x.set(this,void 0);I.set(this,void 0);s(this,x,t,"f");s(this,I,e,"f")}get base58(){return e(this,I,"f")}subscribe(t){if(this.base58){t(this.base58)}const n=e(this,x,"f").on((n=>{switch(n.type){case f.ACCOUNT_CHANGED:s(this,I,n.payload.base58,"f");break;case f.GET_DATA:s(this,I,n.payload.base58,"f");break;default:return}t(e(this,I,"f"))}));return{unsubscribe:()=>n()}}}x=new WeakMap,I=new WeakMap;var X,Y;class J{constructor(t,e){X.set(this,void 0);Y.set(this,void 0);s(this,X,t,"f");if(e){s(this,Y,e,"f")}}get net(){return e(this,Y,"f")}subscribe(t){t(this.net);const n=e(this,X,"f").on((e=>{switch(e.type){case f.GET_DATA:s(this,Y,e.payload.net,"f");break;case f.NETWORK_CHANGED:s(this,Y,e.payload.net,"f");break;default:return}t(this.net)}));return{unsubscribe:()=>n()}}}X=new WeakMap,Y=new WeakMap;var K,H,q,z,F,Q,V,Z;class tt{constructor(t,n){K.add(this);H.set(this,void 0);q.set(this,void 0);z.set(this,void 0);F.set(this,void 0);Q.set(this,false);V.set(this,false);s(this,z,t,"f");s(this,F,n,"f");s(this,H,new B(n),"f");s(this,q,new J(n),"f");e(this,K,"m",Z).call(this)}get account(){return e(this,H,"f")}get network(){return e(this,q,"f")}get connected(){return e(this,Q,"f")}get enabled(){return e(this,V,"f")}async connect(){const t=f.CONNECT_APP;const n=u.CONTENT;const a=g();const i=window.document.title;const o=$();const r={title:i,icon:o,uuid:a};new C({type:t,payload:r}).send(e(this,z,"f"),n);return new Promise(((t,n)=>{const i=e(this,F,"f").on((o=>{if(o.type!==f.RESPONSE_CONNECT_APP)return;if(o.payload.uuid!==a)return;if(o.payload.reject){i();return n(new Error(o.payload.reject))}s(this,Q,Boolean(o.payload.resolve),"f");s(this,H,new B(e(this,F,"f"),o.payload.base58),"f");i();return t(this.connected)}))}))}async signMessage(t){U(this.connected,a);const s=f.SIGN_MESSAGE;const n=u.CONTENT;const i=g();const o=window.document.title;const r=$();const c={message:t,uuid:i,title:o,icon:r};new C({type:s,payload:c}).send(e(this,z,"f"),n);return new Promise(((t,s)=>{const n=e(this,F,"f").on((e=>{if(e.type!==f.SING_MESSAGE_RESULT)return;if(e.payload.uuid!==i)return;if(e.payload&&e.payload.reject){n();return s(new Error(e.payload.reject))}n();return t(e.payload.resolve)}))}))}async signTransaction(t){U(this.connected,a);U(t instanceof P,i);const s=f.TX_TO_SEND;const n=u.CONTENT;const o=g();const r={...t.payload,uuid:o,title:window.document.title,icon:$()};new C({type:s,payload:r}).send(e(this,z,"f"),n);return new Promise(((t,s)=>{const n=e(this,F,"f").on((e=>{if(e.type!==f.TX_TO_SEND_RESULT)return;if(e.payload.uuid!==o)return;if(e.payload&&e.payload.reject){n();return s(new Error(e.payload.reject))}n();return t(e.payload.resolve)}))}))}subscribe(t){const s=e(this,F,"f").on((()=>{setTimeout((()=>t()),1)}));return{unsubscribe:()=>s()}}}H=new WeakMap,q=new WeakMap,z=new WeakMap,F=new WeakMap,Q=new WeakMap,V=new WeakMap,K=new WeakSet,Z=function t(){if(!globalThis.window)return;e(this,F,"f").on((t=>{switch(t.type){case f.LOCKED:s(this,V,t.payload.enabled,"f");break;case f.ACCOUNT_CHANGED:s(this,H,new B(e(this,F,"f"),t.payload.base58),"f");break;case f.GET_DATA:s(this,H,new B(e(this,F,"f"),t.payload.base58),"f");s(this,V,t.payload.enabled,"f");s(this,Q,t.payload.connected,"f");s(this,q,new J(e(this,F,"f"),t.payload.net),"f");break;case f.NETWORK_CHANGED:s(this,q,new J(e(this,F,"f"),t.payload.net),"f");break}}))};var et,st;class nt{constructor(){et.set(this,new O);st.set(this,new k(e(this,et,"f").stream,e(this,et,"f").subject));this.wallet=new tt(e(this,et,"f").stream,e(this,et,"f").subject);this.contract=new h(e(this,st,"f"));this.massa=new j(e(this,st,"f"),this.wallet);if(globalThis.window["bearby"]){throw new Error(c)}try{e(this,et,"f").initialized();globalThis.window["bearby"]=Object.freeze(this)}catch(t){console.debug(r)}}}et=new WeakMap,st=new WeakMap;const at=new nt;t.ContentProvider=k;t.Massa=j;t.Wallet=tt;t.Web3=nt;t.web3=at;Object.defineProperty(t,"__esModule",{value:true})}));
//# sourceMappingURL=index.js.map
