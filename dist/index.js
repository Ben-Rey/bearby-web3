(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports):typeof define==="function"&&define.amd?define(["exports"],t):(e=typeof globalThis!=="undefined"?globalThis:e||self,t(e.web3={}))})(this,(function(e){"use strict";function t(e,t,s,n){if(s==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t==="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?n:s==="a"?n.call(e):n?n.value:t.get(e)}function s(e,t,s,n,a){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof t==="function"?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?a.call(e,s):a?a.value=s:t.set(e,s),s}const n="website favicon is required";const a="Wallet is not connected";const i="Invalid sign params";const o="Request failed by timeout";const r="bearby-web3 available only browser";const c="bearby Web3 instance already created!";class l{constructor(e,t,s,n,a,i,o){this.type=e;this.amount=String(t);this.recipient=s;this.parameter=n;this.contract=a;this.functionName=i;this.datastore=o}get payload(){return JSON.parse(JSON.stringify({type:this.type,amount:this.amount,fee:this.fee,gasPrice:this.gasPrice,gasLimit:this.gasLimit,coins:this.coins,code:this.contract,func:this.functionName,params:JSON.stringify(this.parameter),parallelCoins:this.parallelCoins,sequentialCoins:this.sequentialCoins,toAddr:this.recipient,datastore:this.datastore}))}}var d;(function(e){e[e["Payment"]=0]="Payment";e[e["RollBuy"]=1]="RollBuy";e[e["RollSell"]=2]="RollSell";e[e["ExecuteSC"]=3]="ExecuteSC";e[e["CallSC"]=4]="CallSC"})(d||(d={}));var h;(function(e){e["GET_STATUS"]="get_status";e["GET_ADDRESSES"]="get_addresses";e["GET_BLOCKS"]="get_block";e["GET_ENDORSEMENTS"]="get_endorsements";e["GET_OPERATIONS"]="get_operations";e["GET_CLIQUES"]="get_cliques";e["GET_STAKERS"]="get_stakers";e["GET_FILTERED_SC_OUTPUT_EVENT"]="get_filtered_sc_output_event";e["EXECUTE_READ_ONLY_BYTECODE"]="execute_read_only_bytecode";e["EXECUTE_READ_ONLY_CALL"]="execute_read_only_call"})(h||(h={}));var u,f;class p{constructor(e,t){u.set(this,void 0);f.set(this,void 0);s(this,u,e,"f");s(this,f,t,"f")}async deploy(e){const s=new l(d.ExecuteSC,"0",undefined,undefined,e.contractDataBase64,undefined,e.datastore);s.fee=String(e.fee);s.gasLimit=Number(e.maxGas);s.gasPrice=Number(e.gasPrice);return t(this,f,"f").signTransaction(s)}call(){}async getFilteredSCOutputEvent(e){const s=h.GET_FILTERED_SC_OUTPUT_EVENT;return t(this,u,"f").send([{method:s,params:[e]}])}async executeReadOlyBytecode(e){const s=h.EXECUTE_READ_ONLY_BYTECODE;return t(this,u,"f").send([{method:s,params:[e]}])}async executeReadOnlyCall(e){const s=h.EXECUTE_READ_ONLY_CALL;return t(this,u,"f").send([{method:s,params:[e]}])}}u=new WeakMap,f=new WeakMap;const E="BearBy";const y={CONTENT:`@/${E}/content-script`,INJECTED:`@/${E}/injected-script`};const T={GET_DATA:`@/${E}/get-wallet-data`,ACCOUNT_CHANGED:`@/${E}/accounts-just-changed`,CONTENT_PROXY_MEHTOD:`@/${E}/proxy-method`,CONTENT_PROXY_RESULT:`@/${E}/response-from-content`,CONNECT_APP:`@/${E}/connect-app`,RESPONSE_CONNECT_APP:`@/${E}/respoonse-connect-app`,NETWORK_CHANGED:`@/${E}/network-just-changed`,LOCKED:`@/${E}/guard-just-lock`,TX_TO_SEND:`@/${E}/add-tx-to-send`,TX_TO_SEND_RESULT:`@/${E}/response-tx-result`,SIGN_MESSAGE:`@/${E}/sign-message-call`,SING_MESSAGE_RESULT:`@/${E}/sign-message-response`};var w,_,m,b,N;const{document:S}=globalThis;class g{constructor(e){w.add(this);_.set(this,void 0);s(this,_,e,"f")}listen(e){S.addEventListener(t(this,_,"f"),(t=>{if(t&&t.detail){e(JSON.parse(t.detail))}}))}send(e,s){e.from=t(this,_,"f");if(Object.values(y).includes(s)){t(this,w,"m",m).call(this,JSON.stringify(e),s)}}}_=new WeakMap,w=new WeakSet,m=function e(s,n){S.dispatchEvent(t(this,w,"m",N).call(this,s,n))},b=function e(t){return{detail:t}},N=function e(s,n){return new CustomEvent(n,t(this,w,"m",b).call(this,s))};var C;class O{constructor(){C.set(this,[])}on(e){t(this,C,"f").push(e);return()=>this.removeListener(e)}removeListener(e){const s=t(this,C,"f").indexOf(e);if(s>-1)t(this,C,"f").splice(s,1)}removeAllListeners(){t(this,C,"f").splice(0,t(this,C,"f").length)}emit(...e){t(this,C,"f").forEach((t=>t.apply(this,e)))}once(e){const t=this.on(((...s)=>{t();e.apply(this,s)}))}}C=new WeakMap;var v;class A{constructor(e){v.set(this,void 0);s(this,v,e,"f")}get type(){return t(this,v,"f").type}get payload(){return t(this,v,"f").payload}send(e,s){const n=JSON.stringify(t(this,v,"f"));const a=JSON.parse(n);e.send(a,s)}}v=new WeakMap;class R{constructor(){this.stream=new g(y.INJECTED);this.subject=new O;if(globalThis.document){this.stream.listen((e=>{this.subject.emit(e)}))}}initialized(){const e=T.GET_DATA;const t=y.CONTENT;new A({type:e,payload:{}}).send(this.stream,t)}}function k(){const e=20;return[...Array(e)].map((()=>Math.floor(Math.random()*16).toString(16))).join("")}const D=5e3;var G,P;class M{constructor(e,t){G.set(this,void 0);P.set(this,void 0);s(this,G,e,"f");s(this,P,t,"f")}async send(e){const s=T.CONTENT_PROXY_MEHTOD;const n=y.CONTENT;const a=k();let i;new A({type:s,payload:{body:e,uuid:a}}).send(t(this,G,"f"),n);const r=new Promise(((e,s)=>{i=t(this,P,"f").on((t=>{if(t.type!==T.CONTENT_PROXY_RESULT)return;if(!t.payload||!t.payload.uuid)return;if(t.payload.uuid!==a)return;if(t.payload&&t.payload.reject){i();return s(new Error(t.payload.reject))}delete t.payload.uuid;i();return e(t.payload.resolve)}))}));const c=new Promise(((e,t)=>{setTimeout((()=>{if(i)i();t(new Error(o))}),D)}));return Promise.race([r,c])}}G=new WeakMap,P=new WeakMap;var W,L;class j{constructor(e,t){W.set(this,void 0);L.set(this,void 0);s(this,W,e,"f");s(this,L,t,"f")}async getNodesStatus(){const e=h.GET_STATUS;return t(this,W,"f").send([{method:e,params:[]}])}async getAddresses(...e){const s=h.GET_ADDRESSES;return t(this,W,"f").send([{method:s,params:[e]}])}async getBlocks(...e){const s=h.GET_BLOCKS;return t(this,W,"f").send([{method:s,params:[e]}])}async getOperations(...e){const s=h.GET_OPERATIONS;return t(this,W,"f").send([{method:s,params:[e]}])}async getStakers(){const e=h.GET_STAKERS;return t(this,W,"f").send([{method:e,params:[]}])}async getEndorsements(...e){const s=h.GET_ENDORSEMENTS;return t(this,W,"f").send([{method:s,params:[e]}])}async getCliques(){const e=h.GET_CLIQUES;return t(this,W,"f").send([{method:e,params:[]}])}async payment(e,s){const n=new l(d.Payment,e,s);return t(this,L,"f").signTransaction(n)}async buyRolls(e){const s=new l(d.RollBuy,e);return t(this,L,"f").signTransaction(s)}async sellRolls(e){const s=new l(d.RollSell,e);return t(this,L,"f").signTransaction(s)}}W=new WeakMap,L=new WeakMap;function U(e,t){if(!e){throw new Error(t)}}function x(){let e=globalThis.document.querySelector("link[rel*='icon']");if(!e){throw new Error(n)}return e.href}var $,B;class I{constructor(e,t){$.set(this,void 0);B.set(this,void 0);s(this,$,e,"f");s(this,B,t,"f")}get base58(){return t(this,B,"f")}subscribe(e){if(this.base58){e(this.base58)}const n=t(this,$,"f").on((n=>{switch(n.type){case T.ACCOUNT_CHANGED:s(this,B,n.payload.base58,"f");break;case T.GET_DATA:s(this,B,n.payload.base58,"f");break;default:return}e(t(this,B,"f"))}));return{unsubscribe:()=>n()}}}$=new WeakMap,B=new WeakMap;var X,Y;class J{constructor(e,t){X.set(this,void 0);Y.set(this,void 0);s(this,X,e,"f");if(t){s(this,Y,t,"f")}}get net(){return t(this,Y,"f")}subscribe(e){e(this.net);const n=t(this,X,"f").on((t=>{switch(t.type){case T.GET_DATA:s(this,Y,t.payload.net,"f");break;case T.NETWORK_CHANGED:s(this,Y,t.payload.net,"f");break;default:return}e(this.net)}));return{unsubscribe:()=>n()}}}X=new WeakMap,Y=new WeakMap;var K,H,q,z,F,Q,V,Z;class ee{constructor(e,n){K.add(this);H.set(this,void 0);q.set(this,void 0);z.set(this,void 0);F.set(this,void 0);Q.set(this,false);V.set(this,false);s(this,z,e,"f");s(this,F,n,"f");s(this,H,new I(n),"f");s(this,q,new J(n),"f");t(this,K,"m",Z).call(this)}get account(){return t(this,H,"f")}get network(){return t(this,q,"f")}get connected(){return t(this,Q,"f")}get enabled(){return t(this,V,"f")}async connect(){const e=T.CONNECT_APP;const n=y.CONTENT;const a=k();const i=window.document.title;const o=x();const r={title:i,icon:o,uuid:a};new A({type:e,payload:r}).send(t(this,z,"f"),n);return new Promise(((e,n)=>{const i=t(this,F,"f").on((o=>{if(o.type!==T.RESPONSE_CONNECT_APP)return;if(o.payload.uuid!==a)return;if(o.payload.reject){i();return n(new Error(o.payload.reject))}s(this,Q,Boolean(o.payload.resolve),"f");s(this,H,new I(t(this,F,"f"),o.payload.base58),"f");s(this,q,new J(t(this,F,"f"),o.payload.net),"f");i();return e(this.connected)}))}))}async signMessage(e){U(this.connected,a);const s=T.SIGN_MESSAGE;const n=y.CONTENT;const i=k();const o=window.document.title;const r=x();const c={message:e,uuid:i,title:o,icon:r};new A({type:s,payload:c}).send(t(this,z,"f"),n);return new Promise(((e,s)=>{const n=t(this,F,"f").on((t=>{if(t.type!==T.SING_MESSAGE_RESULT)return;if(t.payload.uuid!==i)return;if(t.payload&&t.payload.reject){n();return s(new Error(t.payload.reject))}n();return e(t.payload.resolve)}))}))}async signTransaction(e){U(this.connected,a);U(e instanceof l,i);const s=T.TX_TO_SEND;const n=y.CONTENT;const o=k();const r={...e.payload,uuid:o,title:window.document.title,icon:x()};new A({type:s,payload:r}).send(t(this,z,"f"),n);return new Promise(((e,s)=>{const n=t(this,F,"f").on((t=>{if(t.type!==T.TX_TO_SEND_RESULT)return;if(t.payload.uuid!==o)return;if(t.payload&&t.payload.reject){n();return s(new Error(t.payload.reject))}n();return e(t.payload.resolve)}))}))}subscribe(e){const s=t(this,F,"f").on((()=>{setTimeout((()=>e()),1)}));return{unsubscribe:()=>s()}}}H=new WeakMap,q=new WeakMap,z=new WeakMap,F=new WeakMap,Q=new WeakMap,V=new WeakMap,K=new WeakSet,Z=function e(){if(!globalThis.window)return;t(this,F,"f").on((e=>{switch(e.type){case T.LOCKED:s(this,V,e.payload.enabled,"f");break;case T.ACCOUNT_CHANGED:s(this,H,new I(t(this,F,"f"),e.payload.base58),"f");break;case T.GET_DATA:s(this,H,new I(t(this,F,"f"),e.payload.base58),"f");s(this,V,e.payload.enabled,"f");s(this,Q,e.payload.connected,"f");s(this,q,new J(t(this,F,"f"),e.payload.net),"f");break;case T.NETWORK_CHANGED:s(this,q,new J(t(this,F,"f"),e.payload.net),"f");break}}))};var te,se;class ne{constructor(){te.set(this,new R);se.set(this,new M(t(this,te,"f").stream,t(this,te,"f").subject));this.wallet=new ee(t(this,te,"f").stream,t(this,te,"f").subject);this.contract=new p(t(this,se,"f"),this.wallet);this.massa=new j(t(this,se,"f"),this.wallet);if(globalThis.window){if(globalThis.window["bearby"]){throw new Error(c)}try{t(this,te,"f").initialized();globalThis.window["bearby"]=Object.freeze(this)}catch(e){console.debug(r)}}}}te=new WeakMap,se=new WeakMap;const ae=new ne;e.ContentProvider=M;e.Massa=j;e.Wallet=ee;e.Web3=ne;e.default=ae;e.web3=ae;Object.defineProperty(e,"__esModule",{value:true})}));
//# sourceMappingURL=index.js.map
