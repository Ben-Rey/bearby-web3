function t(t,e,s,a){if(s==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof e==="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?a:s==="a"?a.call(t):a?a.value:e.get(t)}function e(t,e,s,a,n){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e==="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?n.call(t,s):n?n.value=s:e.set(t,s),s}const s="website favicon is required";const a="Wallet is not connected";const n="Invalid sign params";const r="Request failed by timeout";const i="bearby-web3 available only browser";const o="bearby Web3 instance already created!";class c{constructor(t,e,s,a,n,r,i){this.type=t;this.amount=String(e);this.recipient=s;this.parameter=a;this.contract=n;this.functionName=r;this.datastore=i}get payload(){return JSON.parse(JSON.stringify({type:this.type,amount:this.amount,fee:this.fee,gasPrice:this.gasPrice,gasLimit:this.gasLimit,coins:String(this.coins),code:this.contract,func:this.functionName,params:JSON.stringify(this.parameter),toAddr:this.recipient||this.contract,datastore:this.datastore}))}}var d;(function(t){t[t["Payment"]=0]="Payment";t[t["RollBuy"]=1]="RollBuy";t[t["RollSell"]=2]="RollSell";t[t["ExecuteSC"]=3]="ExecuteSC";t[t["CallSC"]=4]="CallSC"})(d||(d={}));var h;(function(t){t["GET_STATUS"]="get_status";t["GET_ADDRESSES"]="get_addresses";t["GET_BLOCKS"]="get_block";t["GET_ENDORSEMENTS"]="get_endorsements";t["GET_OPERATIONS"]="get_operations";t["GET_CLIQUES"]="get_cliques";t["GET_STAKERS"]="get_stakers";t["GET_FILTERED_SC_OUTPUT_EVENT"]="get_filtered_sc_output_event";t["EXECUTE_READ_ONLY_BYTECODE"]="execute_read_only_bytecode";t["EXECUTE_READ_ONLY_CALL"]="execute_read_only_call";t["GET_DATASTORE_ENTRIES"]="get_datastore_entries"})(h||(h={}));function l(t){let e=new Uint8Array(t.length);Array.prototype.forEach.call(e,((e,s,a)=>{a[s]=t.charCodeAt(s)}));return e}var u,f;class p{constructor(t,s){u.set(this,void 0);f.set(this,void 0);e(this,u,t,"f");e(this,f,s,"f")}async deploy(e){const s=new c(d.ExecuteSC,"0",undefined,undefined,e.contractDataBase64,undefined,e.datastore);s.fee=String(e.fee);s.gasLimit=Number(e.maxGas);s.gasPrice=Number(e.gasPrice);return t(this,f,"f").signTransaction(s)}async call(e){const s=new c(d.CallSC,"0",undefined,e.parameter,e.targetAddress,e.functionName);s.fee=String(e.fee);s.gasLimit=Number(e.maxGas);s.coins=String(e.coins||0);s.gasPrice=Number(e.gasPrice||0);return t(this,f,"f").signTransaction(s)}async getFilteredSCOutputEvent(...e){const s=h.GET_FILTERED_SC_OUTPUT_EVENT;const a=await t(this,u,"f").send(e.map((t=>({method:s,params:[t]}))));if(e.length===1){return a[0]}return a}async getDatastoreEntries(...e){const s=h.GET_DATASTORE_ENTRIES;const a=[];for(const{key:t,address:s}of e){a.push({address:s,key:Array.from(l(t))})}return await t(this,u,"f").send([{method:s,params:[a]}])}async executeReadOlyBytecode(e){const s=h.EXECUTE_READ_ONLY_BYTECODE;return t(this,u,"f").send([{method:s,params:[e]}])}async readSmartContract(...e){const s=h.EXECUTE_READ_ONLY_CALL;const a=await t(this,u,"f").send([{method:s,params:[e.map((e=>({max_gas:e.maxGas,simulated_gas_price:String(e.simulatedGasPrice),target_address:e.targetAddress,target_function:e.targetFunction,parameter:e.parameter,caller_address:e.callerAddress||t(this,f,"f").account.base58})))]}]);if(e.length===1){return a[0]}return a}}u=new WeakMap,f=new WeakMap;const E="BearBy";const y={CONTENT:`@/${E}/content-script`,INJECTED:`@/${E}/injected-script`};const T={GET_DATA:`@/${E}/get-wallet-data`,NEW_SLOT:`@/${E}/new-slot-emited`,ACCOUNT_CHANGED:`@/${E}/accounts-just-changed`,CONTENT_PROXY_MEHTOD:`@/${E}/proxy-method`,CONTENT_PROXY_RESULT:`@/${E}/response-from-content`,CONNECT_APP:`@/${E}/connect-app`,RESPONSE_CONNECT_APP:`@/${E}/respoonse-connect-app`,NETWORK_CHANGED:`@/${E}/network-just-changed`,LOCKED:`@/${E}/guard-just-lock`,TX_TO_SEND:`@/${E}/add-tx-to-send`,TX_TO_SEND_RESULT:`@/${E}/response-tx-result`,SIGN_MESSAGE:`@/${E}/sign-message-call`,SING_MESSAGE_RESULT:`@/${E}/sign-message-response`};var w,_,m,b,S;const{document:N}=globalThis;class g{constructor(t){w.add(this);_.set(this,void 0);e(this,_,t,"f")}listen(e){N.addEventListener(t(this,_,"f"),(t=>{if(t&&t.detail){e(JSON.parse(t.detail))}}))}send(e,s){e.from=t(this,_,"f");if(Object.values(y).includes(s)){t(this,w,"m",m).call(this,JSON.stringify(e),s)}}}_=new WeakMap,w=new WeakSet,m=function e(s,a){N.dispatchEvent(t(this,w,"m",S).call(this,s,a))},b=function t(e){return{detail:e}},S=function e(s,a){return new CustomEvent(a,t(this,w,"m",b).call(this,s))};var O;class C{constructor(){O.set(this,[])}on(e){t(this,O,"f").push(e);return()=>this.removeListener(e)}removeListener(e){const s=t(this,O,"f").indexOf(e);if(s>-1)t(this,O,"f").splice(s,1)}removeAllListeners(){t(this,O,"f").splice(0,t(this,O,"f").length)}emit(...e){t(this,O,"f").forEach((t=>t.apply(this,e)))}once(t){const e=this.on(((...s)=>{e();t.apply(this,s)}))}}O=new WeakMap;var A;class v{constructor(t){A.set(this,void 0);e(this,A,t,"f")}get type(){return t(this,A,"f").type}get payload(){return t(this,A,"f").payload}send(e,s){const a=JSON.stringify(t(this,A,"f"));const n=JSON.parse(a);e.send(n,s)}}A=new WeakMap;class k{constructor(){this.stream=new g(y.INJECTED);this.subject=new C;if(globalThis.document){this.stream.listen((t=>{this.subject.emit(t)}))}}initialized(){const t=T.GET_DATA;const e=y.CONTENT;new v({type:t,payload:{}}).send(this.stream,e)}}function R(){const t=20;return[...Array(t)].map((()=>Math.floor(Math.random()*16).toString(16))).join("")}const G=5e3;var P,D;class L{constructor(t,s){P.set(this,void 0);D.set(this,void 0);e(this,P,t,"f");e(this,D,s,"f")}async send(e){const s=T.CONTENT_PROXY_MEHTOD;const a=y.CONTENT;const n=R();let i;new v({type:s,payload:{body:e,uuid:n}}).send(t(this,P,"f"),a);const o=new Promise(((e,s)=>{i=t(this,D,"f").on((t=>{if(t.type!==T.CONTENT_PROXY_RESULT)return;if(!t.payload||!t.payload.uuid)return;if(t.payload.uuid!==n)return;if(t.payload&&t.payload.reject){i();return s(new Error(t.payload.reject))}delete t.payload.uuid;i();return e(t.payload.resolve)}))}));const c=new Promise(((t,e)=>{setTimeout((()=>{if(i)i();e(new Error(r))}),G)}));return Promise.race([o,c])}}P=new WeakMap,D=new WeakMap;var M,W;class U{constructor(t,s){M.set(this,void 0);W.set(this,void 0);e(this,M,t,"f");e(this,W,s,"f")}async getNodesStatus(){const e=h.GET_STATUS;return t(this,M,"f").send([{method:e,params:[]}])}async getAddresses(...e){const s=h.GET_ADDRESSES;return t(this,M,"f").send([{method:s,params:[e]}])}async getBlocks(...e){const s=h.GET_BLOCKS;return t(this,M,"f").send([{method:s,params:[e]}])}async getOperations(...e){const s=h.GET_OPERATIONS;return t(this,M,"f").send([{method:s,params:[e]}])}async getStakers(){const e=h.GET_STAKERS;return t(this,M,"f").send([{method:e,params:[]}])}async getEndorsements(...e){const s=h.GET_ENDORSEMENTS;return t(this,M,"f").send([{method:s,params:[e]}])}async getCliques(){const e=h.GET_CLIQUES;return t(this,M,"f").send([{method:e,params:[]}])}async payment(e,s){const a=new c(d.Payment,e,s);return t(this,W,"f").signTransaction(a)}async buyRolls(e){const s=new c(d.RollBuy,e);return t(this,W,"f").signTransaction(s)}async sellRolls(e){const s=new c(d.RollSell,e);return t(this,W,"f").signTransaction(s)}}M=new WeakMap,W=new WeakMap;function j(t,e){if(!t){throw new Error(e)}}function x(){let t=globalThis.document.querySelector("link[rel*='icon']");if(!t){throw new Error(s)}return t.href}var I;class ${constructor(t){I.set(this,void 0);e(this,I,t,"f")}subscribe(e){if(this.base58){e(this.base58)}const s=t(this,I,"f").on((t=>{switch(t.type){case T.ACCOUNT_CHANGED:this.base58=t.payload.base58;break;case T.RESPONSE_CONNECT_APP:this.base58=t.payload.base58;break;case T.GET_DATA:this.base58=t.payload.base58;break;default:return}e(this.base58)}));return{unsubscribe:()=>s()}}}I=new WeakMap;var B;class X{constructor(t){B.set(this,void 0);e(this,B,t,"f")}subscribe(e){e(this.net);const s=t(this,B,"f").on((t=>{switch(t.type){case T.RESPONSE_CONNECT_APP:this.net=t.payload.net;break;case T.GET_DATA:this.net=t.payload.net;break;case T.NETWORK_CHANGED:this.net=t.payload.net;break;default:return}e(this.net)}));return{unsubscribe:()=>s()}}}B=new WeakMap;var K;class Y{constructor(t){K.set(this,void 0);this.period=-1;e(this,K,t,"f")}subscribe(e){const s=t(this,K,"f").on((t=>{switch(t.type){case T.NEW_SLOT:this.period=t.payload;e(this.period);break;case T.GET_DATA:this.period=t.payload.period;e(this.period);break;case T.NETWORK_CHANGED:this.period=t.payload.period;e(this.period);break}}));return{unsubscribe:()=>s()}}}K=new WeakMap;var H,J,q,F,z,Q,V,Z,tt;class et{constructor(s,a){H.add(this);J.set(this,void 0);q.set(this,void 0);F.set(this,void 0);z.set(this,void 0);Q.set(this,void 0);V.set(this,false);Z.set(this,false);e(this,z,s,"f");e(this,Q,a,"f");e(this,J,new $(a),"f");e(this,q,new X(a),"f");e(this,F,new Y(a),"f");t(this,H,"m",tt).call(this)}get account(){return t(this,J,"f")}get network(){return t(this,q,"f")}get blockchain(){return t(this,F,"f")}get connected(){return t(this,V,"f")}get enabled(){return t(this,Z,"f")}async connect(){const s=T.CONNECT_APP;const a=y.CONTENT;const n=R();const r=window.document.title;const i=x();const o={title:r,icon:i,uuid:n};new v({type:s,payload:o}).send(t(this,z,"f"),a);return new Promise(((s,a)=>{const r=t(this,Q,"f").on((i=>{if(i.type!==T.RESPONSE_CONNECT_APP)return;if(i.payload.uuid!==n)return;if(i.payload.reject){r();return a(new Error(i.payload.reject))}e(this,V,Boolean(i.payload.resolve),"f");t(this,J,"f").base58=i.payload.base58;t(this,q,"f").net=i.payload.net;r();return s(this.connected)}))}))}async signMessage(e){j(this.connected,a);const s=T.SIGN_MESSAGE;const n=y.CONTENT;const r=R();const i=window.document.title;const o=x();const c={message:e,uuid:r,title:i,icon:o};new v({type:s,payload:c}).send(t(this,z,"f"),n);return new Promise(((e,s)=>{const a=t(this,Q,"f").on((t=>{if(t.type!==T.SING_MESSAGE_RESULT)return;if(t.payload.uuid!==r)return;if(t.payload&&t.payload.reject){a();return s(new Error(t.payload.reject))}a();return e(t.payload.resolve)}))}))}async signTransaction(e){j(this.connected,a);j(e instanceof c,n);const s=T.TX_TO_SEND;const r=y.CONTENT;const i=R();const o={...e.payload,uuid:i,title:window.document.title,icon:x()};new v({type:s,payload:o}).send(t(this,z,"f"),r);return new Promise(((e,s)=>{const a=t(this,Q,"f").on((t=>{if(t.type!==T.TX_TO_SEND_RESULT)return;if(t.payload.uuid!==i)return;if(t.payload&&t.payload.reject){a();return s(new Error(t.payload.reject))}a();return e(t.payload.resolve)}))}))}}J=new WeakMap,q=new WeakMap,F=new WeakMap,z=new WeakMap,Q=new WeakMap,V=new WeakMap,Z=new WeakMap,H=new WeakSet,tt=function s(){if(!globalThis.window)return;t(this,Q,"f").on((s=>{switch(s.type){case T.NEW_SLOT:t(this,F,"f").period=s.payload;break;case T.LOCKED:e(this,Z,s.payload.enabled,"f");break;case T.ACCOUNT_CHANGED:t(this,J,"f").base58=s.payload.base58;break;case T.GET_DATA:t(this,F,"f").period=s.payload.period;t(this,J,"f").base58=s.payload.base58;e(this,Z,s.payload.enabled,"f");e(this,V,s.payload.connected,"f");t(this,q,"f").net=s.payload.net;break;case T.NETWORK_CHANGED:t(this,q,"f").net=s.payload.net;t(this,F,"f").period=s.payload.period;break}}))};var st,at;class nt{constructor(){st.set(this,new k);at.set(this,new L(t(this,st,"f").stream,t(this,st,"f").subject));this.wallet=new et(t(this,st,"f").stream,t(this,st,"f").subject);this.contract=new p(t(this,at,"f"),this.wallet);this.massa=new U(t(this,at,"f"),this.wallet);if(globalThis.window){if(globalThis.window["bearby"]){throw new Error(o)}try{t(this,st,"f").initialized();globalThis.window["bearby"]=Object.freeze(this)}catch(t){console.debug(i)}}}}st=new WeakMap,at=new WeakMap;function rt(){if(globalThis.window&&globalThis.window["bearby"]){return globalThis.window["bearby"]}return new nt}const it=rt();export{L as ContentProvider,p as Contract,U as Massa,et as Wallet,nt as Web3,it as web3};
//# sourceMappingURL=index.js.map
