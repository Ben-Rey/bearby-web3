var web3=function(t){"use strict";function e(t,e,s,a){if(s==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof e==="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?a:s==="a"?a.call(t):a?a.value:e.get(t)}function s(t,e,s,a,n){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e==="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?n.call(t,s):n?n.value=s:e.set(t,s),s}const a="website favicon is required";const n="Wallet is not connected";const r="Invalid sign params";const i="Request failed by timeout";const o="bearby-web3 available only browser";const c="bearby Web3 instance already created!";class d{constructor(t,e,s,a,n,r,i){this.type=t;this.amount=String(e);this.recipient=s;this.parameter=a;this.contract=n;this.functionName=r;this.datastore=i}get payload(){return JSON.parse(JSON.stringify({type:this.type,amount:this.amount,fee:this.fee,gasPrice:this.gasPrice,gasLimit:this.gasLimit,coins:String(this.coins),code:this.contract,func:this.functionName,params:JSON.stringify(this.parameter),toAddr:this.recipient||this.contract,datastore:this.datastore}))}}var l;(function(t){t[t["Payment"]=0]="Payment";t[t["RollBuy"]=1]="RollBuy";t[t["RollSell"]=2]="RollSell";t[t["ExecuteSC"]=3]="ExecuteSC";t[t["CallSC"]=4]="CallSC"})(l||(l={}));var h;(function(t){t["GET_STATUS"]="get_status";t["GET_ADDRESSES"]="get_addresses";t["GET_BLOCKS"]="get_block";t["GET_ENDORSEMENTS"]="get_endorsements";t["GET_OPERATIONS"]="get_operations";t["GET_CLIQUES"]="get_cliques";t["GET_STAKERS"]="get_stakers";t["GET_FILTERED_SC_OUTPUT_EVENT"]="get_filtered_sc_output_event";t["EXECUTE_READ_ONLY_BYTECODE"]="execute_read_only_bytecode";t["EXECUTE_READ_ONLY_CALL"]="execute_read_only_call";t["GET_DATASTORE_ENTRIES"]="get_datastore_entries"})(h||(h={}));function u(t){let e=new Uint8Array(t.length);Array.prototype.forEach.call(e,((e,s,a)=>{a[s]=t.charCodeAt(s)}));return e}var f,p;class E{constructor(t,e){f.set(this,void 0);p.set(this,void 0);s(this,f,t,"f");s(this,p,e,"f")}async deploy(t){const s=new d(l.ExecuteSC,"0",undefined,undefined,t.contractDataBase64,undefined,t.datastore);s.fee=String(t.fee);s.gasLimit=Number(t.maxGas);s.gasPrice=Number(t.gasPrice);return e(this,p,"f").signTransaction(s)}async call(t){const s=new d(l.CallSC,"0",undefined,t.parameter,t.targetAddress,t.functionName);s.fee=String(t.fee);s.gasLimit=Number(t.maxGas);s.coins=String(t.coins||0);s.gasPrice=Number(t.gasPrice||0);return e(this,p,"f").signTransaction(s)}async getFilteredSCOutputEvent(...t){const s=h.GET_FILTERED_SC_OUTPUT_EVENT;const a=await e(this,f,"f").send(t.map((t=>({method:s,params:[t]}))));if(t.length===1){return a[0]}return a}async getDatastoreEntries(...t){const s=h.GET_DATASTORE_ENTRIES;const a=[];for(const{key:e,address:s}of t){a.push({address:s,key:Array.from(u(e))})}return await e(this,f,"f").send([{method:s,params:[a]}])}async executeReadOlyBytecode(t){const s=h.EXECUTE_READ_ONLY_BYTECODE;return e(this,f,"f").send([{method:s,params:[t]}])}async readSmartContract(...t){const s=h.EXECUTE_READ_ONLY_CALL;const a=await e(this,f,"f").send([{method:s,params:[t.map((t=>({max_gas:t.maxGas,simulated_gas_price:String(t.simulatedGasPrice),target_address:t.targetAddress,target_function:t.targetFunction,parameter:t.parameter,caller_address:t.callerAddress||e(this,p,"f").account.base58})))]}]);if(t.length===1){return a[0]}return a}}f=new WeakMap,p=new WeakMap;const y="BearBy";const T={CONTENT:`@/${y}/content-script`,INJECTED:`@/${y}/injected-script`};const w={GET_DATA:`@/${y}/get-wallet-data`,NEW_SLOT:`@/${y}/new-slot-emited`,ACCOUNT_CHANGED:`@/${y}/accounts-just-changed`,CONTENT_PROXY_MEHTOD:`@/${y}/proxy-method`,CONTENT_PROXY_RESULT:`@/${y}/response-from-content`,CONNECT_APP:`@/${y}/connect-app`,RESPONSE_CONNECT_APP:`@/${y}/respoonse-connect-app`,NETWORK_CHANGED:`@/${y}/network-just-changed`,LOCKED:`@/${y}/guard-just-lock`,TX_TO_SEND:`@/${y}/add-tx-to-send`,TX_TO_SEND_RESULT:`@/${y}/response-tx-result`,SIGN_MESSAGE:`@/${y}/sign-message-call`,SING_MESSAGE_RESULT:`@/${y}/sign-message-response`};var _,m,b,S,N;const{document:g}=globalThis;class O{constructor(t){_.add(this);m.set(this,void 0);s(this,m,t,"f")}listen(t){g.addEventListener(e(this,m,"f"),(e=>{if(e&&e.detail){t(JSON.parse(e.detail))}}))}send(t,s){t.from=e(this,m,"f");if(Object.values(T).includes(s)){e(this,_,"m",b).call(this,JSON.stringify(t),s)}}}m=new WeakMap,_=new WeakSet,b=function t(s,a){g.dispatchEvent(e(this,_,"m",N).call(this,s,a))},S=function t(e){return{detail:e}},N=function t(s,a){return new CustomEvent(a,e(this,_,"m",S).call(this,s))};var C;class A{constructor(){C.set(this,[])}on(t){e(this,C,"f").push(t);return()=>this.removeListener(t)}removeListener(t){const s=e(this,C,"f").indexOf(t);if(s>-1)e(this,C,"f").splice(s,1)}removeAllListeners(){e(this,C,"f").splice(0,e(this,C,"f").length)}emit(...t){e(this,C,"f").forEach((e=>e.apply(this,t)))}once(t){const e=this.on(((...s)=>{e();t.apply(this,s)}))}}C=new WeakMap;var v;class k{constructor(t){v.set(this,void 0);s(this,v,t,"f")}get type(){return e(this,v,"f").type}get payload(){return e(this,v,"f").payload}send(t,s){const a=JSON.stringify(e(this,v,"f"));const n=JSON.parse(a);t.send(n,s)}}v=new WeakMap;class R{constructor(){this.stream=new O(T.INJECTED);this.subject=new A;if(globalThis.document){this.stream.listen((t=>{this.subject.emit(t)}))}}initialized(){const t=w.GET_DATA;const e=T.CONTENT;new k({type:t,payload:{}}).send(this.stream,e)}}function P(){const t=20;return[...Array(t)].map((()=>Math.floor(Math.random()*16).toString(16))).join("")}const G=5e3;var D,W;class L{constructor(t,e){D.set(this,void 0);W.set(this,void 0);s(this,D,t,"f");s(this,W,e,"f")}async send(t){const s=w.CONTENT_PROXY_MEHTOD;const a=T.CONTENT;const n=P();let r;new k({type:s,payload:{body:t,uuid:n}}).send(e(this,D,"f"),a);const o=new Promise(((t,s)=>{r=e(this,W,"f").on((e=>{if(e.type!==w.CONTENT_PROXY_RESULT)return;if(!e.payload||!e.payload.uuid)return;if(e.payload.uuid!==n)return;if(e.payload&&e.payload.reject){r();return s(new Error(e.payload.reject))}delete e.payload.uuid;r();return t(e.payload.resolve)}))}));const c=new Promise(((t,e)=>{setTimeout((()=>{if(r)r();e(new Error(i))}),G)}));return Promise.race([o,c])}}D=new WeakMap,W=new WeakMap;var M,U;class j{constructor(t,e){M.set(this,void 0);U.set(this,void 0);s(this,M,t,"f");s(this,U,e,"f")}async getNodesStatus(){const t=h.GET_STATUS;return e(this,M,"f").send([{method:t,params:[]}])}async getAddresses(...t){const s=h.GET_ADDRESSES;return e(this,M,"f").send([{method:s,params:[t]}])}async getBlocks(...t){const s=h.GET_BLOCKS;return e(this,M,"f").send([{method:s,params:[t]}])}async getOperations(...t){const s=h.GET_OPERATIONS;return e(this,M,"f").send([{method:s,params:[t]}])}async getStakers(){const t=h.GET_STAKERS;return e(this,M,"f").send([{method:t,params:[]}])}async getEndorsements(...t){const s=h.GET_ENDORSEMENTS;return e(this,M,"f").send([{method:s,params:[t]}])}async getCliques(){const t=h.GET_CLIQUES;return e(this,M,"f").send([{method:t,params:[]}])}async payment(t,s){const a=new d(l.Payment,t,s);return e(this,U,"f").signTransaction(a)}async buyRolls(t){const s=new d(l.RollBuy,t);return e(this,U,"f").signTransaction(s)}async sellRolls(t){const s=new d(l.RollSell,t);return e(this,U,"f").signTransaction(s)}}M=new WeakMap,U=new WeakMap;function I(t,e){if(!t){throw new Error(e)}}function $(){let t=globalThis.document.querySelector("link[rel*='icon']");if(!t){throw new Error(a)}return t.href}var x;class B{constructor(t){x.set(this,void 0);s(this,x,t,"f")}subscribe(t){if(this.base58){t(this.base58)}const s=e(this,x,"f").on((e=>{switch(e.type){case w.ACCOUNT_CHANGED:this.base58=e.payload.base58;break;case w.RESPONSE_CONNECT_APP:this.base58=e.payload.base58;break;case w.GET_DATA:this.base58=e.payload.base58;break;default:return}t(this.base58)}));return{unsubscribe:()=>s()}}}x=new WeakMap;var X;class K{constructor(t){X.set(this,void 0);s(this,X,t,"f")}subscribe(t){t(this.net);const s=e(this,X,"f").on((e=>{switch(e.type){case w.RESPONSE_CONNECT_APP:this.net=e.payload.net;break;case w.GET_DATA:this.net=e.payload.net;break;case w.NETWORK_CHANGED:this.net=e.payload.net;break;default:return}t(this.net)}));return{unsubscribe:()=>s()}}}X=new WeakMap;var Y;class H{constructor(t){Y.set(this,void 0);this.period=-1;s(this,Y,t,"f")}subscribe(t){const s=e(this,Y,"f").on((e=>{switch(e.type){case w.NEW_SLOT:this.period=e.payload;t(this.period);break;case w.GET_DATA:this.period=e.payload.period;t(this.period);break;case w.NETWORK_CHANGED:this.period=e.payload.period;t(this.period);break}}));return{unsubscribe:()=>s()}}}Y=new WeakMap;var J,q,F,z,Q,V,Z,tt,et;class st{constructor(t,a){J.add(this);q.set(this,void 0);F.set(this,void 0);z.set(this,void 0);Q.set(this,void 0);V.set(this,void 0);Z.set(this,false);tt.set(this,false);s(this,Q,t,"f");s(this,V,a,"f");s(this,q,new B(a),"f");s(this,F,new K(a),"f");s(this,z,new H(a),"f");e(this,J,"m",et).call(this)}get account(){return e(this,q,"f")}get network(){return e(this,F,"f")}get blockchain(){return e(this,z,"f")}get connected(){return e(this,Z,"f")}get enabled(){return e(this,tt,"f")}async connect(){const t=w.CONNECT_APP;const a=T.CONTENT;const n=P();const r=window.document.title;const i=$();const o={title:r,icon:i,uuid:n};new k({type:t,payload:o}).send(e(this,Q,"f"),a);return new Promise(((t,a)=>{const r=e(this,V,"f").on((i=>{if(i.type!==w.RESPONSE_CONNECT_APP)return;if(i.payload.uuid!==n)return;if(i.payload.reject){r();return a(new Error(i.payload.reject))}s(this,Z,Boolean(i.payload.resolve),"f");e(this,q,"f").base58=i.payload.base58;e(this,F,"f").net=i.payload.net;r();return t(this.connected)}))}))}async signMessage(t){I(this.connected,n);const s=w.SIGN_MESSAGE;const a=T.CONTENT;const r=P();const i=window.document.title;const o=$();const c={message:t,uuid:r,title:i,icon:o};new k({type:s,payload:c}).send(e(this,Q,"f"),a);return new Promise(((t,s)=>{const a=e(this,V,"f").on((e=>{if(e.type!==w.SING_MESSAGE_RESULT)return;if(e.payload.uuid!==r)return;if(e.payload&&e.payload.reject){a();return s(new Error(e.payload.reject))}a();return t(e.payload.resolve)}))}))}async signTransaction(t){I(this.connected,n);I(t instanceof d,r);const s=w.TX_TO_SEND;const a=T.CONTENT;const i=P();const o={...t.payload,uuid:i,title:window.document.title,icon:$()};new k({type:s,payload:o}).send(e(this,Q,"f"),a);return new Promise(((t,s)=>{const a=e(this,V,"f").on((e=>{if(e.type!==w.TX_TO_SEND_RESULT)return;if(e.payload.uuid!==i)return;if(e.payload&&e.payload.reject){a();return s(new Error(e.payload.reject))}a();return t(e.payload.resolve)}))}))}}q=new WeakMap,F=new WeakMap,z=new WeakMap,Q=new WeakMap,V=new WeakMap,Z=new WeakMap,tt=new WeakMap,J=new WeakSet,et=function t(){if(!globalThis.window)return;e(this,V,"f").on((t=>{switch(t.type){case w.NEW_SLOT:e(this,z,"f").period=t.payload;break;case w.LOCKED:s(this,tt,t.payload.enabled,"f");break;case w.ACCOUNT_CHANGED:e(this,q,"f").base58=t.payload.base58;break;case w.GET_DATA:e(this,z,"f").period=t.payload.period;e(this,q,"f").base58=t.payload.base58;s(this,tt,t.payload.enabled,"f");s(this,Z,t.payload.connected,"f");e(this,F,"f").net=t.payload.net;break;case w.NETWORK_CHANGED:e(this,F,"f").net=t.payload.net;e(this,z,"f").period=t.payload.period;break}}))};var at,nt;class rt{constructor(){at.set(this,new R);nt.set(this,new L(e(this,at,"f").stream,e(this,at,"f").subject));this.wallet=new st(e(this,at,"f").stream,e(this,at,"f").subject);this.contract=new E(e(this,nt,"f"),this.wallet);this.massa=new j(e(this,nt,"f"),this.wallet);if(globalThis.window){if(globalThis.window["bearby"]){throw new Error(c)}try{e(this,at,"f").initialized();globalThis.window["bearby"]=Object.freeze(this)}catch(t){console.debug(o)}}}}at=new WeakMap,nt=new WeakMap;function it(){if(globalThis.window&&globalThis.window["bearby"]){return globalThis.window["bearby"]}return new rt}const ot=it();t.ContentProvider=L;t.Contract=E;t.Massa=j;t.Wallet=st;t.Web3=rt;t.web3=ot;return t}({});
//# sourceMappingURL=index.js.map
