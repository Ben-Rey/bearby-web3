<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <script src="./dist//index.js"></script>
</head>
<body>
  <button onclick="deploy()">deploy</button>
  <button onclick="readBalance()">readBalance</button>
  <button onclick="transfer()">transfer</button>
  <button onclick="disconnect()">disconect</button>
  <button onclick="connect()">conect</button>

  <script>
    window.contract = '';
    async function disconnect() {
      const status = await bearby.wallet.diconnect();
      console.log(status);
    }
    async function connect() {
      const status = await bearby.wallet.connect();
      console.log(status);
    }
    async function deploy() {
      const hash = await bearby.contract.deploy({
          fee: 18033,
          maxGas: 20000000,
          maxGas: 200000,
          contractDataBase64: "AGFzbQEAAAABMQlgAn9/AGABfwF/YAAAYAJ/fwF/YAF/AGADf39/AX9gA39/fwBgBH9/f38AYAJ/fgACegQDZW52BWFib3J0AAcFbWFzc2EbYXNzZW1ibHlfc2NyaXB0X2dldF9vcF9kYXRhAAEFbWFzc2EZYXNzZW1ibHlfc2NyaXB0X2NyZWF0ZV9zYwABBW1hc3NhHmFzc2VtYmx5X3NjcmlwdF9nZW5lcmF0ZV9ldmVudAAEAy8uBAABAAAAAAMGAAAABQMBAAMGCAMDAwICAgICAgIFAQAABQEBAQEDAwQCAQQCAgQFAXABAQEFAwEAAQZ8Fn8AQQALfwBBAQt/AEECC38BQQALfwFBAAt/AEEAC38BQQALfwFBAAt/AEHQAwt/AEHwAwt/AEGgBAt/AEHQBAt/AEGABQt/AEGwBQt/AEHQBQt+AEIAC38AQYAGC38AQbAGC38AQdAGC38AQfAGC38AQYAIC38AQcQICwdFBwRtYWluAC0FX19uZXcACwVfX3BpbgAuB19fdW5waW4ALwlfX2NvbGxlY3QAMAtfX3J0dGlfYmFzZQMUBm1lbW9yeQIACAExCQYBAEEBCwAMARYKnwkuYAEFfz8AIQEgAUEQdEEPakEPQX9zcSECIAAgAksEQCAAIAJrQf//A2pB//8DQX9zcUEQdiEDIAEiBCADIgUgBCAFShshBCAEQABBAEgEQCADQABBAEgEQAALCwsgACQECwkAIAAgATYCAAtRAQR/IABB/P///wNLBEBBkAFB0AFBIUEdEAAACyMEIQEjBEEEaiECAn8gACEDIANBBGpBD2pBD0F/c3FBBGsLIQQgAiAEahAEIAEgBBAFIAILCQAgACABNgIECwkAIAAgATYCCAsJACAAIAE2AgwLCQAgACABNgIQC0sBAn8gAEHs////A0sEQEGQAUHQAUHWAEEeEAAAC0EQIABqEAYhAiACQQRrIQMgA0EAEAcgA0EAEAggAyABEAkgAyAAEAogAkEQagsDAAELEQAgACABNgIAIAAgAUEAEAwLCQAgACABNgIECwkAIAAgATYCCAtvAQF/IABFBEBBDEECEAshAAsgAEEAEA0gAEEAEA4gAEEAEA8gAUH8////AyACdksEQEEgQdAAQRNBORAAAAsgASACdCIBQQAQCyEDQQAjAkcaIANBACAB/AsAIAAgAxANIAAgAxAOIAAgARAPIAALHAAgAEUEQEEMQQQQCyEACyAAIAFBABAQIQAgAAsNACAAQRRrKAIQQQB2CxEAIAAgATYCCCAAIAFBABAMCy4BAX8gASAAEBJPBEBBkAJB0AJBzgBBKRAAAAsgACABQQB0ai0AACECQQAaIAILKAAgASAAKAIITwRAQZACQZADQbIBQS0QAAALIAAoAgQgAWogAjoAAAsJACAAIAE3AwALYwECfyAARQRAQQxBAxALIQALIABCABAWIABBAEEAEBEQEyAAQQAgARASEBEQE0EAIQICQANAIAIgARASSCEDIAMEQAJAIAAoAgggAiABIAIQFBAVCyACQQFqIQIMAQsLCyAACz8BAn8gAUH8////A0EAdksEQEEgQdACQTNBPBAAAAsgAUEAdCECIAJBBRALIQNBACMCRxogA0EAIAL8CwAgAwshAAJAAkACQCMGDgIBAgALAAtBAEEAEBghAQsgACABEBcLJQAjFUEEakEPakEPQX9zcUEEayQDIwMkBEEAQQAkBkEAEBkkBwsEABAaCwQAEBsLBAAQHAsEABAdCwQAEB4LBAAQHwsdAQF/IAAgARALIQMgAgRAIAMgAiAA/AoAAAsgAwsGACAAEAELEQAgACABNgIAIAAgAUEAEAwLCQAgACABOgAECyoAIABFBEBBBUEGEAshAAsgAEEAECMgAEEAECQgACABECMgACACECQgAAsKAEEAIABBARAlCwgAIAAQAhAmCwcAIAAoAgALDQAgAEEUaygCEEEBdgtKAQR/IAAQKUEBdCECIAEQKUEBdCEDIAIgA2ohBCAEQQBGBEBB8AcPCyAEQQEQCyEFIAUgACAC/AoAACAFIAJqIAEgA/wKAAAgBQsIACAAIAEQKgsGACAAEAMLJgEDf0EFQQVBoAcQISEAIAAQIiEBIAEQJyECQcAHIAIQKBArECwLBAAgAAsDAAELAwABCwQAECALC7cJFgBBDAswLAAAAAAAAAAAAAAAAQAAABwAAABJAG4AdgBhAGwAaQBkACAAbABlAG4AZwB0AGgAAEE8C0A8AAAAAAAAAAAAAAABAAAAJgAAAH4AbABpAGIALwBhAHIAcgBhAHkAYgB1AGYAZgBlAHIALgB0AHMAAAAAAAAAAEH8AAtAPAAAAAAAAAAAAAAAAQAAACgAAABBAGwAbABvAGMAYQB0AGkAbwBuACAAdABvAG8AIABsAGEAcgBnAGUAAAAAAABBvAELQDwAAAAAAAAAAAAAAAEAAAAeAAAAfgBsAGkAYgAvAHIAdAAvAHMAdAB1AGIALgB0AHMAAAAAAAAAAAAAAAAAAAAAQfwBC0A8AAAAAAAAAAAAAAABAAAAJAAAAEkAbgBkAGUAeAAgAG8AdQB0ACAAbwBmACAAcgBhAG4AZwBlAAAAAAAAAAAAAEG8AgtAPAAAAAAAAAAAAAAAAQAAACYAAAB+AGwAaQBiAC8AcwB0AGEAdABpAGMAYQByAHIAYQB5AC4AdABzAAAAAAAAAABB/AILQDwAAAAAAAAAAAAAAAEAAAAkAAAAfgBsAGkAYgAvAHQAeQBwAGUAZABhAHIAcgBhAHkALgB0AHMAAAAAAAAAAAAAQbwDCyAcAAAAAAAAAAAAAAABAAAABAAAADoAOgAAAAAAAAAAAABB3AMLMCwAAAAAAAAAAAAAAAEAAAAQAAAAVABSAEEATgBTAEYARQBSAAAAAAAAAAAAAAAAAABBjAQLMCwAAAAAAAAAAAAAAAEAAAAQAAAAQQBQAFAAUgBPAFYAQQBMAAAAAAAAAAAAAAAAAABBvAQLMCwAAAAAAAAAAAAAAAEAAAAQAAAAbwB3AG4AZQByAE8AZgBfAAAAAAAAAAAAAAAAAABB7AQLMCwAAAAAAAAAAAAAAAEAAAAOAAAAQwBvAHUAbgB0AGUAcgAAAAAAAAAAAAAAAAAAAABBnAULIBwAAAAAAAAAAAAAAAEAAAAKAAAATwB3AG4AZQByAAAAAEG8BQswLAAAAAAAAAAAAAAAAQAAAA4AAABiAGEAcwBlAFUAUgBJAAAAAAAAAAAAAAAAAAAAAEHsBQswLAAAAAAAAAAAAAAAAQAAABIAAABNAEEAUwBTAEEAXwBOAEYAVAAAAAAAAAAAAAAAAEGcBgsgHAAAAAAAAAAAAAAAAQAAAAYAAABOAEYAVAAAAAAAAAAAQbwGCyAcAAAAAAAAAAAAAAABAAAACgAAADEAMAAwADAAMAAAAABB3AYLMCwAAAAAAAAAAAAAAAEAAAAcAAAAbQBhAHMAcwBhAC4AbgBlAHQALwBuAGYAdAAvAABBjAcLIBwAAAAAAAAAAAAAAAUAAAAFAAAAAAECAwQAAAAAAAAAAEGsBwswLAAAAAAAAAAAAAAAAQAAABwAAABTAEMAIABjAHIAZQBhAHQAZQBkACAAYQB0ADoAAEHcBwsgHAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAQYAIC0QIAAAAIAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBAAAAAgAAAGQAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAA=="
      });

      let k = 0;
      const intr = setInterval(async() => {
        const eventsFilter = {
          start: null,
          end: null,
          original_caller_address: null,
          original_operation_id: hash,
          emitter_address: null,
        };
        const response = await bearby.contract.getFilteredSCOutputEvent(eventsFilter);
        if (response && response.result && response.result[0] && response.result[0].data) {
          clearInterval(intr);
          window.contract = String(response.result[0].data).replace('Address:', '');
          console.log(window.contract);
          alert(window.contract);
        }

        console.log(response);

        if (k > 10) {
          clearInterval(intr);
        }
        k += 1;
      }, 4000);
    }

    async function readBalance() {
      const data = await bearby.contract.readSmartContract({
        fee: 0,
        maxGas: 200000,
        simulatedGasPrice: 0,
        targetAddress: window.contract,
        targetFunction: "balanceOf",
        parameter: bearby.wallet.account.base58
      });
      console.log('readSmartContract', data);
    }

    async function transfer() {
      const hash = await bearby.contract.call({
        maxGas: 2000000,
        coins: 0,
        targetAddress: window.contract,
        functionName: 'transfer',
        parameter: {
          toAccount: 'AU1jRkWpQuLyXbHm8PkQ78X3JNBt4RxBLpqSgotfmGBmPtPvxpoc',
          nbTokens: '0'
        }
      });

      console.log(hash);
    }

    console.log(bearby);
  </script>
</body>
</html>
